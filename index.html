<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>小王子的世界</title>
  <style>
body {
  font-family: 'Segoe UI', 'Helvetica Neue', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
  background: linear-gradient(135deg, #232946 0%, #1a1a2e 100%);
  margin: 0;
  min-height: 100vh;
  position: relative;
  overflow-x: hidden;
}
.container {
  max-width: 820px;
  margin: 60px auto 40px auto;
  background: rgba(34, 39, 63, 0.92);
  border-radius: 36px;
  box-shadow: 0 12px 40px rgba(44,62,80,0.18);
  padding: 48px 0 36px 0;
  position: relative;
  z-index: 2;
}
h1, h2, p {
  color: #fffbe7;
}
#preview {
  display: flex;
  flex-direction: column;
  gap: 38px;
  margin: 0 auto;
  max-width: 600px;
  width: 100%;
  align-items: center;
}
.timeline {
  position: relative;
  width: 100%;
  padding-left: 32px;
  box-sizing: border-box;
}
.timeline::before {
  content: '';
  position: absolute;
  left: 16px;
  top: 0;
  bottom: 0;
  width: 4px;
  background: linear-gradient(180deg, #a0c4ff 0%, #bdb2ff 100%);
  border-radius: 2px;
  opacity: 0.18;
}
.timeline-item {
  position: relative;
  margin-bottom: 36px;
  display: flex;
  flex-direction: row;
  align-items: flex-start;
  width: 100%;
}
.timeline-dot {
  position: absolute;
  left: 8px;
  top: 24px;
  width: 16px;
  height: 16px;
  background: #a0c4ff;
  border: 3px solid #fffbe7;
  border-radius: 50%;
  box-shadow: 0 2px 8px #a0c4ff44;
  z-index: 2;
}
.timeline-content {
  margin-left: 36px;
  flex: 1;
  position: relative;
}
.timeline-date {
  position: absolute;
  left: -120px;
  top: -8px;
  color: #bdb2ff;
  font-size: 1.25rem;
  font-family: 'Segoe Script', 'Segoe UI', cursive, sans-serif;
  letter-spacing: 1px;
  background: rgba(34,39,63,0.92);
  padding: 2px 16px 2px 8px;
  border-radius: 16px;
  box-shadow: 0 2px 8px #23294622;
  min-width: 90px;
  text-align: left;
  z-index: 3;
}
.photo-card, .mood-card {
  background: linear-gradient(120deg, #232946 60%, #393e6c 100%);
  border-radius: 26px;
  box-shadow: 0 6px 24px rgba(160,196,255,0.10);
  padding: 22px 18px 16px 18px;
  display: flex;
  flex-direction: column;
  align-items: center;
  max-width: 420px;
  margin: 0 auto;
  border: 1.5px solid #a0c4ff;
  min-width: 0;
}
.photo-card img {
  max-width: 320px;
  max-height: 220px;
  border-radius: 18px;
  box-shadow: 0 2px 16px rgba(255,193,7,0.10);
  border: 2px solid #a0c4ff;
  margin-bottom: 12px;
  background: #232946;
}
.photo-card .desc, .mood-card .desc {
  color: #a0c4ff;
  font-size: 1.13rem;
  text-align: center;
  max-width: 320px;
  word-break: break-all;
  font-family: 'Segoe Print', 'Segoe UI', cursive, sans-serif;
  margin-bottom: 4px;
}
.photo-card .pub-date, .mood-card .pub-date {
  color: #bdb2ff;
  font-size: 0.98rem;
  margin-top: 6px;
  font-family: 'Segoe UI', Arial, sans-serif;
  text-align: right;
  width: 100%;
}
.stars {
  position: fixed;
  left: 0; top: 0; width: 100vw; height: 100vh;
  pointer-events: none;
  z-index: 0;
}
.star {
  position: absolute;
  width: 2.5px; height: 2.5px;
  background: #fffbe7;
  border-radius: 50%;
  opacity: 0.7;
  animation: twinkle 2.5s infinite ease-in-out;
}
@keyframes twinkle {
  0%,100% { opacity: 0.7; }
  50% { opacity: 0.2; }
}
@media (max-width: 700px) {
  .container { padding: 0 0vw; }
  #preview { gap: 22px; max-width: 98vw; }
  .timeline-content { margin-left: 28px; }
  .timeline-date {
    position: static;
    display: block;
    margin-bottom: 6px;
    left: 0;
    top: 0;
    font-size: 1.08rem;
    padding: 2px 10px;
    min-width: 0;
    text-align: left;
    background: rgba(34,39,63,0.92);
  }
  .photo-card, .mood-card { max-width: 96vw; padding: 12px 4vw 10px 4vw; }
  .photo-card img { max-width: 90vw; max-height: 40vw; }
}
  </style>
  <!-- 星空背景 -->
  <div class="stars" id="stars"></div>
  <!-- 小王子SVG装饰 -->
  <svg class="nature-decor little-prince" width="120" height="220" viewBox="0 0 120 220" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g>
      <ellipse cx="60" cy="210" rx="38" ry="10" fill="#bdb2ff" opacity="0.18"/>
      <circle cx="60" cy="70" r="38" fill="#ffe082" stroke="#f8b500" stroke-width="2"/>
      <ellipse cx="60" cy="120" rx="32" ry="50" fill="#f8b500"/>
      <ellipse cx="60" cy="120" rx="28" ry="44" fill="#ffe082"/>
      <ellipse cx="60" cy="120" rx="18" ry="30" fill="#fffbe7"/>
      <!-- 头发 -->
      <ellipse cx="60" cy="55" rx="20" ry="10" fill="#f8b500"/>
      <!-- 脸部 -->
      <ellipse cx="60" cy="75" rx="15" ry="15" fill="#fffbe7"/>
      <!-- 眼睛 -->
      <ellipse cx="54" cy="78" rx="2.2" ry="2.2" fill="#232946"/>
      <ellipse cx="66" cy="78" rx="2.2" ry="2.2" fill="#232946"/>
      <!-- 微笑 -->
      <path d="M55 85 Q60 90 65 85" stroke="#232946" stroke-width="1.2" fill="none"/>
      <!-- 围巾 -->
      <rect x="44" y="90" width="32" height="10" rx="5" fill="#bdb2ff"/>
      <rect x="70" y="95" width="18" height="6" rx="3" fill="#bdb2ff" transform="rotate(15 70 95)"/>
      <!-- 身体 -->
      <rect x="50" y="100" width="20" height="50" rx="10" fill="#a0c4ff"/>
      <!-- 手臂 -->
      <rect x="30" y="110" width="18" height="6" rx="3" fill="#ffe082" transform="rotate(-20 30 110)"/>
      <rect x="72" y="110" width="18" height="6" rx="3" fill="#ffe082" transform="rotate(20 72 110)"/>
      <!-- 腿 -->
      <rect x="54" y="150" width="6" height="30" rx="3" fill="#bdb2ff"/>
      <rect x="60" y="150" width="6" height="30" rx="3" fill="#bdb2ff"/>
    </g>
  </svg>
  <!-- 自然装饰SVG -->
  <svg class="nature-decor nature-leaf" width="160" height="120" viewBox="0 0 160 120" fill="none" xmlns="http://www.w3.org/2000/svg">
    <ellipse cx="80" cy="60" rx="80" ry="60" fill="#a5d6a7"/>
    <path d="M80 60 Q100 20 140 40 Q120 80 80 60 Z" fill="#66bb6a"/>
  </svg>
  <svg class="nature-decor nature-cloud" width="200" height="90" viewBox="0 0 200 90" fill="none" xmlns="http://www.w3.org/2000/svg">
    <ellipse cx="60" cy="60" rx="60" ry="30" fill="#b3e5fc"/>
    <ellipse cx="120" cy="50" rx="50" ry="25" fill="#b3e5fc"/>
    <ellipse cx="170" cy="70" rx="30" ry="15" fill="#b3e5fc"/>
  </svg>
</head>
<body>
  <div class="container">
    <h1>小王子的世界</h1>
    <p>欢迎来到我的个人博客！这里你可以浏览我分享的照片和心情。<br>“所有的大人都曾经是小孩，虽然，只有少数的人记得。”</p>
    <h2>我的照片分享</h2>
    <div id="preview">
      <div class="timeline" id="timeline"></div>
      <div id="pagination" style="display:flex;justify-content:center;align-items:center;margin:24px 0 0 0;gap:18px;"></div>
    </div>
  </div>
  <!-- 神秘标志按钮 -->
  <div id="mysteryMask" style="position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:99;background:rgba(34,39,63,0.98);display:flex;align-items:center;justify-content:center;transition:opacity 0.7s;">
    <button id="mysteryBtn" style="background:none;border:none;outline:none;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:12px;">
      <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg" style="filter:drop-shadow(0 0 12px #bdb2ff88);animation: mysteryFloat 2.5s infinite alternate;">
        <circle cx="40" cy="40" r="36" fill="#bdb2ff" opacity="0.22"/>
        <ellipse cx="40" cy="40" rx="28" ry="28" fill="#a0c4ff"/>
        <text x="50%" y="54%" text-anchor="middle" fill="#232946" font-size="38" font-family="Segoe Script,Segoe UI,cursive" dy=".3em">?</text>
      </svg>
      <span style="color:#bdb2ff;font-size:1.18rem;font-family:'Segoe Script','Segoe UI',cursive;letter-spacing:1px;">点我探索神秘世界</span>
      <!-- 动画箭头 -->
      <span class="mystery-arrow">
        <svg width="32" height="32" viewBox="0 0 32 32"><g><path d="M16 8v16M16 24l-7-7M16 24l7-7" stroke="#bdb2ff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/></g></svg>
      </span>
    </button>
  </div>
  <!-- 右上角音乐控制喇叭 -->
  <button id="musicToggle" title="音乐开关" style="position:fixed;top:24px;right:32px;z-index:120;background:none;border:none;outline:none;cursor:pointer;padding:0;display:flex;align-items:center;justify-content:center;">
    <svg id="icon-music-on" width="36" height="36" viewBox="0 0 36 36" fill="none" style="display:block;"><circle cx="18" cy="18" r="17" fill="#bdb2ff" opacity="0.22"/><path d="M10 22h4l6 5V9l-6 5h-4v8z" fill="#a0c4ff" stroke="#232946" stroke-width="1.5"/><path d="M25 13c1.5 1.5 1.5 8.5 0 10" stroke="#232946" stroke-width="2" fill="none"/></svg>
    <svg id="icon-music-off" width="36" height="36" viewBox="0 0 36 36" fill="none" style="display:none;"><circle cx="18" cy="18" r="17" fill="#bdb2ff" opacity="0.22"/><path d="M10 22h4l6 5V9l-6 5h-4v8z" fill="#a0c4ff" stroke="#232946" stroke-width="1.5"/><line x1="12" y1="12" x2="24" y2="24" stroke="#ff5252" stroke-width="2.5"/></svg>
  </button>
  <!-- 背景音乐播放器（自动播放，点击神秘标志后触发） -->
  <audio id="bgm" src="https://lzhimagebed.xyz/%E9%99%88%E5%A5%95%E8%BF%85%20-%20%E6%B7%98%E6%B1%B0.mp3" loop preload="auto" style="display:none"></audio>
  <style>
@keyframes mysteryFloat {
  0% { transform: translateY(0px) scale(1); }
  100% { transform: translateY(-18px) scale(1.06); }
}
@keyframes arrowBounce {
  0% { transform: translateY(0); opacity: 0.7; }
  50% { transform: translateY(16px); opacity: 1; }
  100% { transform: translateY(0); opacity: 0.7; }
}
.mystery-arrow {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 6px;
  animation: arrowBounce 1.2s infinite;
}
#musicToggle {
  transition: opacity 0.3s;
  background: none;
}
#musicToggle svg { filter: drop-shadow(0 2px 8px #bdb2ff44); }
#musicToggle:active { opacity: 0.7; }
@media (max-width: 700px) {
  #musicToggle { top: 8px; right: 8px; }
}
#preview { opacity: 0; pointer-events: none; transition: opacity 0.7s; }
#preview.unlocked { opacity: 1; pointer-events: auto; transition: opacity 0.7s; }
  </style>
  <script>
  // 星空背景生成
  (function(){
    const starCount = 80;
    const stars = document.getElementById('stars');
    for(let i=0;i<starCount;i++){
      const s = document.createElement('div');
      s.className = 'star';
      s.style.left = Math.random()*100+'vw';
      s.style.top = Math.random()*100+'vh';
      s.style.animationDelay = (Math.random()*2.5)+'s';
      stars.appendChild(s);
    }
  })();

  // 分页参数
  const PAGE_SIZE = 3;
  let currentPage = 1;
  let allPhotos = [];

  // 自动加载 desc.json 并渲染图片和描述（时间轴风格+分页）
  async function loadPhotos() {
    const timeline = document.getElementById('timeline');
    const pagination = document.getElementById('pagination');
    timeline.innerHTML = '';
    pagination.innerHTML = '';
    try {
      const resp = await fetch('desc.json');
      if (!resp.ok) throw new Error('desc.json 加载失败');
      const data = await resp.json();
      // 适配新版结构
      let photos = [];
      if (Array.isArray(data)) {
        // 兼容旧结构
        photos = data;
      } else if (data && Array.isArray(data.days)) {
        // 新结构，合并所有 days.items，并保留 date 字段
        data.days.forEach(day => {
          if (Array.isArray(day.items)) {
            day.items.forEach(item => {
              photos.push({ ...item, date: day.date, dayTitle: day.title || '', dayDesc: day.desc || '' });
            });
          }
        });
      } else {
        throw new Error('desc.json 格式错误');
      }
      allPhotos = photos;
      renderPage(currentPage);
    } catch (e) {
      timeline.innerHTML = '<div style="color:#c00;text-align:center;width:100%">无法加载 desc.json，<br>请确保通过本地服务器访问（如 VSCode Live Server、Python SimpleHTTPServer 等），否则浏览器安全策略会阻止读取本地文件。<br>错误信息：'+e.message+'</div>';
      allPhotos = [];
      // 依然允许解锁内容区
      document.getElementById('preview').classList.add('unlocked');
      document.getElementById('mysteryMask').style.display = 'none';
    }
  }

  function renderPage(page) {
    const timeline = document.getElementById('timeline');
    const pagination = document.getElementById('pagination');
    timeline.innerHTML = '';
    pagination.innerHTML = '';
    const total = allPhotos.length;
    const totalPages = Math.ceil(total / PAGE_SIZE);
    if (page < 1) page = 1;
    if (page > totalPages) page = totalPages;
    currentPage = page;
    const start = (page - 1) * PAGE_SIZE;
    const end = Math.min(start + PAGE_SIZE, total);
    const pageItems = allPhotos.slice(start, end);
    pageItems.forEach((item, idx) => {
      const itemWrap = document.createElement('div');
      itemWrap.className = 'timeline-item';
      const dot = document.createElement('div');
      dot.className = 'timeline-dot';
      itemWrap.appendChild(dot);
      // 神秘标志按钮
      const secretBtn = document.createElement('button');
      secretBtn.className = 'secret-btn';
      secretBtn.innerHTML = `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="16" cy="16" r="15" fill="#bdb2ff" stroke="#a0c4ff" stroke-width="2"/><text x="16" y="21" text-anchor="middle" font-size="18" fill="#232946" font-family="Segoe UI,Arial,sans-serif">?</text></svg><span class='secret-tip'>点我探索</span>`;
      secretBtn.style.cssText = 'background:none;border:none;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:2px;outline:none;';
      // 内容区域
      const content = document.createElement('div');
      content.className = 'timeline-content secret-content';
      content.style.opacity = '0';
      content.style.pointerEvents = 'none';
      content.style.transition = 'opacity 0.7s cubic-bezier(.23,1.02,.32,1)';
      // 日期大号显示在左上
      if(item.date) {
        const date = document.createElement('div');
        date.className = 'timeline-date';
        date.textContent = formatDate(item.date);
        content.appendChild(date);
      }
      let card;
      if(item.type === 'image' || (!item.type && item.src && /\.(jpg|jpeg|png|gif|webp)$/i.test(item.src))) {
        card = document.createElement('div');
        card.className = 'photo-card';
        const img = document.createElement('img');
        img.src = item.src;
        img.alt = item.desc || '';
        img.loading = 'lazy';
        card.appendChild(img);
      } else if(item.type === 'video' || (item.src && /\.(mp4|webm|ogg)$/i.test(item.src))) {
        card = document.createElement('div');
        card.className = 'photo-card';
        const video = document.createElement('video');
        video.src = item.src;
        video.controls = true;
        video.style.maxWidth = '180px';
        video.style.maxHeight = '180px';
        video.style.borderRadius = '18px';
        video.style.background = '#f1f8e9';
        card.appendChild(video);
      } else if(item.type === 'text' && !item.src) {
        card = document.createElement('div');
        card.className = 'mood-card';
      } else {
        card = document.createElement('div');
        card.className = 'photo-card';
      }
      if(item.desc) {
        const desc = document.createElement('div');
        desc.className = 'desc';
        desc.textContent = item.desc;
        card.appendChild(desc);
      }
      content.appendChild(card);
      // 点击神秘标志后显示内容
      secretBtn.addEventListener('click', function() {
        content.style.opacity = '1';
        content.style.pointerEvents = 'auto';
        secretBtn.style.opacity = '0';
        secretBtn.style.pointerEvents = 'none';
        setTimeout(()=>{ secretBtn.style.display = 'none'; }, 700);
      });
      itemWrap.appendChild(secretBtn);
      itemWrap.appendChild(content);
      timeline.appendChild(itemWrap);
    });
    // 分页按钮
    if (total > PAGE_SIZE) {
      const prevBtn = document.createElement('button');
      prevBtn.textContent = '上一页';
      prevBtn.disabled = currentPage === 1;
      prevBtn.style.cssText = 'padding:6px 18px;border-radius:8px;border:none;background:#a0c4ff;color:#232946;font-size:1rem;cursor:pointer;opacity:'+(currentPage===1?0.5:1)+';';
      prevBtn.onclick = () => { renderPage(currentPage-1); if (isMobile()) window.scrollTo({top:0,behavior:'smooth'}); };
      pagination.appendChild(prevBtn);
      const pageInfo = document.createElement('span');
      pageInfo.textContent = `第 ${currentPage} / ${totalPages} 页`;
      pageInfo.style.cssText = 'color:#bdb2ff;font-size:1.08rem;margin:0 8px;';
      pagination.appendChild(pageInfo);
      const nextBtn = document.createElement('button');
      nextBtn.textContent = '下一页';
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.style.cssText = 'padding:6px 18px;border-radius:8px;border:none;background:#a0c4ff;color:#232946;font-size:1rem;cursor:pointer;opacity:'+(currentPage===totalPages?0.5:1)+';';
      nextBtn.onclick = () => { renderPage(currentPage+1); if (isMobile()) window.scrollTo({top:0,behavior:'smooth'}); };
      pagination.appendChild(nextBtn);
    }
    if (allPhotos.length === 0) {
      timeline.innerHTML = '<div style="color:#888;text-align:center;width:100%">暂无照片，请在 images/ 目录添加图片并编辑 desc.json</div>';
    }
  }

  // 新增：格式化日期函数
  function formatDate(dateStr) {
    if(!dateStr) return '';
    const d = new Date(dateStr);
    if(isNaN(d)) return dateStr;
    return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
  }
  loadPhotos();
  // 重新触发时间轴动画（翻页时）
  function reAnimateTimeline() {
    document.querySelectorAll('.timeline-item').forEach((el,i)=>{
      el.style.animation = 'none';
      el.offsetHeight; // 触发重绘
      el.style.animation = '';
    });
  }
  // 在 renderPage 后调用
  const oldRenderPage = renderPage;
  renderPage = function(page) {
    oldRenderPage(page);
    setTimeout(reAnimateTimeline, 10);
  }
  // 新增：判断是否为移动端
  function isMobile() {
    return /Mobi|Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);
  }
  // 神秘标志捉迷藏交互
  let mysteryUnlocked = false;
  function unlockMystery() {
    if (mysteryUnlocked) return;
    mysteryUnlocked = true;
    document.getElementById('mysteryMask').style.opacity = 0;
    setTimeout(function(){
      document.getElementById('mysteryMask').style.display = 'none';
      document.getElementById('preview').classList.add('unlocked');
    }, 700);
    // 自动播放背景音乐
    var audio = document.getElementById('bgm');
    if(audio) {
      audio.play().catch(function(){});
      updateMusicIcon();
    }
  }
  document.getElementById('mysteryBtn').addEventListener('click', unlockMystery);
  // 6秒未点击自动触发
  setTimeout(function(){
    if (!mysteryUnlocked) unlockMystery();
  }, 6000);
  // 音乐开关按钮逻辑
  function updateMusicIcon() {
    var audio = document.getElementById('bgm');
    var on = document.getElementById('icon-music-on');
    var off = document.getElementById('icon-music-off');
    if(audio && !audio.paused) {
      on.style.display = 'block';
      off.style.display = 'none';
    } else {
      on.style.display = 'none';
      off.style.display = 'block';
    }
  }
  document.getElementById('musicToggle').addEventListener('click', function(){
    var audio = document.getElementById('bgm');
    if(audio.paused) {
      audio.play().catch(function(){});
    } else {
      audio.pause();
    }
    updateMusicIcon();
  });
  document.getElementById('bgm').addEventListener('play', updateMusicIcon);
  document.getElementById('bgm').addEventListener('pause', updateMusicIcon);
  // 初始隐藏内容
  document.getElementById('preview').classList.remove('unlocked');
  </script>
</body>
</html>
